schema: '2.0'
stages:
  data_preparation:
    cmd: py -m src.operators.data_preparation --config=params.yaml --input-dir=data\raw
      --output-dir=data\prepared
    deps:
    - path: data\raw
      md5: 63aecd37950ec75d992549d925068acd.dir
      size: 412284
      nfiles: 50
    - path: src\operators\data_preparation.py
      md5: c4cdf8ffd005ed1ca9c0a705b3910c02
      size: 1428
    params:
      params.yaml:
        data_preparation:
          data_formatter: PngFormatter
    outs:
    - path: data\prepared
      md5: 72bcb1e643859ea2c62bcd12c9eb9c27.dir
      size: 7645904
      nfiles: 50
  data_splitting:
    cmd: py -m src.operators.data_splitting --config=params.yaml --input-dir=data\prepared
      --output-dir=data\split
    deps:
    - path: data\prepared
      md5: 72bcb1e643859ea2c62bcd12c9eb9c27.dir
      size: 7645904
      nfiles: 50
    - path: src\operators\data_splitting.py
      md5: cbaa52f909473ab0a66de449edc519d9
      size: 1753
    params:
      params.yaml:
        data_splitting:
          batch_size: 32
          color_mode: rgb
          image_size:
          - 256
          - 256
          shuffle: true
          train_seed: 0
          valid_seed: 42
          validation_split: 0.2
    outs:
    - path: data\split
      md5: c0a6909f57b4b6b31418d8b775dbbed4.dir
      size: 39322214
      nfiles: 6
  data_valid_preprocessing:
    cmd: py -m src.operators.data_valid_preprocessing --config=params.yaml --input-dir=data\split
      --output-dir=data\preprocessed
    deps:
    - path: data\split\valid
      md5: 8409ca8787d1cf4ec3b7e0b9db0ed256.dir
      size: 7864532
      nfiles: 3
    - path: src\operators\data_valid_preprocessing.py
      md5: 945d6b62b1644940a775cac0ff8d9cdc
      size: 1611
    params:
      params.yaml:
        data_valid_preprocessing:
          transformations:
          - name: Rescaling
            scale: 0.00392156862745098
    outs:
    - path: data\preprocessed\valid
      md5: e8a13ccb4a09a602a97ee8953a854d50.dir
      size: 7864531
      nfiles: 3
  data_train_preprocessing:
    cmd: py -m src.operators.data_train_preprocessing --config=params.yaml --input-dir=data\split
      --output-dir=data\preprocessed
    deps:
    - path: data\split\train
      md5: 9e2aa12ec9764bd85a7eb9af877cb523.dir
      size: 31457682
      nfiles: 3
    - path: src\operators\data_train_preprocessing.py
      md5: a847225ed5a39a52af3d417ee41a78ab
      size: 1548
    params:
      params.yaml:
        data_train_preprocessing:
          transformations:
          - name: Rescaling
            scale: 0.00392156862745098
          - mode: horizontal_and_vertical
            name: RandomFlip
          - factor: 0.2
            name: RandomRotation
    outs:
    - path: data\preprocessed\train
      md5: 429857677a45364df03b639505d608eb.dir
      size: 31457682
      nfiles: 3
  model_training:
    cmd: py -m src.operators.model_training --config=params.yaml --input-dir=data\preprocessed
      --model-dir=mlruns
    deps:
    - path: data\preprocessed\train
      md5: 429857677a45364df03b639505d608eb.dir
      size: 31457682
      nfiles: 3
    - path: src\operators\model_training.py
      md5: 06ae063fb4d6890aba3863b3fc84f46a
      size: 2091
    params:
      params.yaml:
        model_training:
          experiment: new-exp-test-5
          run_name: a_name
          compiler:
            loss: sparse_categorical_crossentropy
            metrics:
            - accuracy
            optimizer: RMSprop
          input_shape:
            image_height: 256
            image_width: 256
            n_channels: 3
          model_cfg:
          - activation: relu
            filters: 32
            kernel_size: 3
            name: Conv2D
            padding: same
            strides: 2
          - name: BatchNormalization
          - name: MaxPooling2D
            pool_size:
            - 2
            - 2
          - name: BatchNormalization
          - activation: relu
            filters: 64
            kernel_size: 3
            name: Conv2D
            padding: same
            strides: 1
          - name: BatchNormalization
          - name: MaxPooling2D
            pool_size:
            - 2
            - 2
          - name: BatchNormalization
          - activation: relu
            filters: 128
            kernel_size: 3
            name: Conv2D
            padding: same
            strides: 1
          - name: BatchNormalization
          - name: MaxPooling2D
            pool_size:
            - 2
            - 2
          - name: BatchNormalization
          - name: Flatten
          - activation: relu
            name: Dense
            units: 256
          - name: BatchNormalization
          - name: Dropout
            rate: 0.5
          - activation: softmax
            name: Dense
            units: 10
          training_cfg:
            batch_size: 32
            epochs: 1
    outs:
    - path: mlruns
      md5: 6179b2a25c69f7ab79f34ad3ccf8fb7c.dir
      size: 615111425
      nfiles: 110
  model_evaluation:
    cmd: py -m src.operators.model_evaluation --config=params.yaml --input-dir=data\preprocessed
      --model-dir=mlruns
    deps:
    - path: data\preprocessed\valid
      md5: e8a13ccb4a09a602a97ee8953a854d50.dir
      size: 7864531
      nfiles: 3
    - path: mlruns
      md5: 6179b2a25c69f7ab79f34ad3ccf8fb7c.dir
      size: 615111425
      nfiles: 110
    - path: src\operators\model_evaluation.py
      md5: 760a502f0dd19da6c3cfda178c654212
      size: 1306
    params:
      params.yaml:
        model_evaluation:
          batch_size: 32
      configs/mlflow_last_run.yaml:
        experiment_id: '6'
        run_id: e3725d688c6248d680de593a21f8ba51
